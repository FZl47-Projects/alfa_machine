{% extends 'base/base_template.html' %}
{% load static %}
{% load render_partial %}

{% block Title %}
    پروژه - {{ project.name }}
{% endblock %}

{% block BodyClass %}
    has-rtl nk-body ui-rounder has-sidebar no-touch nk-nio-theme
{% endblock %}


{% block Content %}
    <div class="nk-app-root">
        <!-- main @s -->
        <div class="nk-main">
            <!-- sidebar @s -->
            {% render_partial 'public.components.MenuComponent' %}
            <!-- sidebar @e -->
            <!-- wrap @s -->
            <div class="nk-wrap">
                <!-- main header @s -->
                {% include 'base/components/header.html' %}
                <!-- main header @e -->
                <!-- content @s -->
                <div class="nk-content nk-content-fluid">
                    <div class="container-xl wide-xl">
                        <div class="nk-content-body">
                            <div class="nk-block-head nk-block-head-sm">
                                <div class="nk-block-between g-3">
                                    <div class="nk-block-head-content">
                                        <h3 class="nk-block-title page-title">جزئیات پروژه</h3>
                                        <nav>
                                            <ul class="breadcrumb breadcrumb-arrow">
                                                <li class="breadcrumb-item"><a href="{% url 'public:index' %}">صفحه
                                                    اصلی</a></li>
                                                <li class="breadcrumb-item"><a>پروژه ها</a></li>
                                                <li class="breadcrumb-item"><a href="{% url 'public:project__list' %}">لیست
                                                    پروژه ها</a></li>
                                                <li class="breadcrumb-item active">{{ project.name }}</li>
                                            </ul>
                                        </nav>
                                    </div>
                                    <!-- .nk-block-head-content -->
                                    <div class="nk-block-head-content">
                                        <div class="toggle-wrap nk-block-tools-toggle">
                                            <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1"
                                               data-target="pageMenu"><em class="icon ni ni-menu-alt-r"></em></a>
                                            <div class="toggle-expand-content" data-content="pageMenu">
                                                <ul class="nk-block-tools g-3">
                                                    <li>
                                                        <a href="#" class="btn btn-white btn-dim btn-outline-light"><em
                                                                class="icon ni ni-download-cloud"></em><span>خروجی گرفتن</span></a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- .nk-block-head-content -->
                                </div>
                                <!-- .nk-block-between -->
                            </div>
                            <div class="nk-block">
                                <div class="card">
                                    <div class="card-aside-wrap">
                                        <div class="card-content">
                                            <ul class="nav nav-tabs nav-tabs-mb-icon nav-tabs-card">
                                                <li class="nav-item">
                                                    <a class="nav-link active" data-bs-toggle="tab" href="#info"><em
                                                            class="icon ni ni-info"></em><span>اطلاعات</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab" href="#statistics"><em
                                                            class="icon ni ni-chart-up"></em><span>امار</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link"
                                                       href="{% url 'public:task__list' %}?filter=true&project={{ project.id }}"><em
                                                            class="icon ni ni-task"></em><span>تسک ها</span></a>
                                                </li>
                                                {% if has_perm_to_steps %}
                                                    <li class="nav-item">
                                                        <a class="nav-link" data-bs-toggle="tab" href="#steps"><em
                                                                class="icon ni ni-activity-round"></em><span>مرحله ها</span></a>
                                                    </li>
                                                {% endif %}
                                                <li class="nav-item">
                                                    <a class="nav-link"
                                                       href="{% url 'support:ticket__list' %}?filter=true&projects={{ project.id }}"><em
                                                            class="icon ni ni-view-col"></em><span>گزارشات</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link"
                                                       href="{% url 'public:project_file__list' %}?filter=true&project={{ project.id }}"><em
                                                            class="icon ni ni-file-text"></em><span>فایل ها</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link"
                                                       href="{% url 'notification:notification__list' %}?filter=true&projects={{ project.id }}"><em
                                                            class="icon ni ni-notice"></em><span>اعلانات</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab"
                                                       href="#warehouse"><em
                                                            class="icon ni ni-book"></em><span>امور انبار</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab" href="#financial"><em
                                                            class="icon ni ni-coin-alt"></em><span>امور مالی</span></a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab" href="#note"><em
                                                            class="icon ni ni-pen2"></em><span>یادداشت های شخصی</span></a>
                                                </li>
                                                <li class="nav-item nav-item-trigger d-xxl-none">
                                                    <a href="#" class="toggle btn btn-icon btn-trigger"
                                                       data-target="userAside"><em
                                                            class="icon ni ni-dashboard"></em></a>
                                                </li>
                                            </ul>
                                            <!-- .nav-tabs -->
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="info">
                                                    <div class="card-inner">
                                                        <div class="nk-block">
                                                            <div class="nk-block-head">
                                                                <h5 class="title">اطلاعات پایه</h5>
                                                            </div>
                                                            <!-- .nk-block-head -->
                                                            <div class="profile-ud-list">
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">نام</span>
                                                                        <span class="profile-ud-value">{{ project.name }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">مشتری</span>
                                                                        <span class="profile-ud-value">
                                                                    <a href="{{ project.task_master.get_absolute_url }}">{{ project.task_master.name }}</a>
                                                                </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">شماره درخواست</span>
                                                                        <span class="profile-ud-value">{{ project.number_id|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">پرداخت شده</span>
                                                                        <span class="profile-ud-value">
                                                                    {% if project.is_paid %}
                                                                        <span class="text-success">پرداخت شده</span>
                                                                    {% else %}
                                                                        <span class="text-danger">پرداخت نشده</span>
                                                                    {% endif %}
                                                                </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">نمونه</span>
                                                                        <span class="profile-ud-value">
                                                                    {% if project.has_sample %}
                                                                        <span class="text-info">
                                                                            دارد
                                                                        </span>
                                                                    {% else %}
                                                                        <span class="text-warning">
                                                                            ندارد
                                                                        </span>
                                                                    {% endif %}
                                                                </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">قیمت</span>
                                                                        <span class="profile-ud-value">
                                                                    {% if project.price %}
                                                                        <span class="price-el">
                                                                            {{ project.price }}
                                                                            تومان
                                                                        </span>
                                                                    {% else %}
                                                                        <span>ثبت نشده است</span>
                                                                    {% endif %}
                                                                </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- .profile-ud-list -->
                                                        </div>
                                                        <!-- .nk-block -->
                                                        <div class="nk-block">
                                                            <div class="nk-block-head nk-block-head-line">
                                                                <h6 class="title overline-title text-base">اطلاعات
                                                                    تکمیلی</h6>
                                                            </div>
                                                            <!-- .nk-block-head -->
                                                            <div class="profile-ud-list">
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تعداد کل</span>
                                                                        <span class="profile-ud-value">{{ project.count_total }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تعداد باقی مانده</span>
                                                                        <span class="profile-ud-value">{{ project.count_remaining }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">استعلام مربوطه</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if project.inquiry %}
                                                                                <a href="{{ project.inquiry.get_absolute_url }}">{{ project.inquiry.title|truncatechars:30 }}</a>
                                                                            {% else %}
                                                                                <em class="icon ni ni-cross-c text-warning"></em>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تاریخ پیش پرداخت</span>
                                                                        <span class="profile-ud-value">{{ project.prepayment_datetime|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تاریخ تحویل نمونه</span>
                                                                        <span class="profile-ud-value">{{ project.sample_delivery_date|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تاریخ تحویل انبوه</span>
                                                                        <span class="profile-ud-value">{{ project.mass_delivery_date|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تاریخ ابلاغ(شروع)</span>
                                                                        <span class="profile-ud-value">{{ project.time_start|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تاریخ اتمام قرارداد</span>
                                                                        <span class="profile-ud-value">{{ project.time_end|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item w-100">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">مرحله</span>
                                                                        <span class="profile-ud-value">{{ project.get_last_step|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item w-100">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">ایتم ها</span>
                                                                        <span class="profile-ud-value">{{ project.item|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item w-100">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">توضیحات</span>
                                                                        <span class="profile-ud-value">{{ project.description|default:'-' }}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- .profile-ud-list -->
                                                        </div>
                                                        <!-- .nk-block -->
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="statistics">
                                                    <div class="card-inner">
                                                        <div class="nk-block">
                                                            <div class="nk-block-head">
                                                                <h5 class="title">امار</h5>
                                                            </div>
                                                        </div>
                                                        <div class="nk-block">
                                                            <div class="nk-block-head nk-block-head-line">
                                                                <h6 class="title overline-title text-base">نمودار مرحله
                                                                    ها</h6>
                                                            </div>
                                                            <div class="my-2">
                                                                <p class="text-center fs-17px">نفر/روز</p>
                                                                <canvas id="chart_step_1" width="400"
                                                                        data-chart="{{ data_chart_step_1 }}"
                                                                        height="350"></canvas>
                                                            </div>
                                                            <div class="my-2">
                                                                <p class="text-center fs-17px">نفر/ساعت</p>
                                                                <canvas id="chart_step_2" width="400"
                                                                        data-chart="{{ data_chart_step_2 }}"
                                                                        height="350"></canvas>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="financial">
                                                    <div class="card-inner">
                                                        <div class="nk-block">
                                                            <div class="nk-block-head">
                                                                <h5 class="title">امور مالی</h5>
                                                            </div>
                                                            <div class="profile-ud-list">
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">پرداختی ها</span>
                                                                        <span class="profile-ud-value">
                                                                            <a href="{% url 'dp_financial:payment__list' %}?filter=true&project={{ project.id }}">مشاهده</a>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">ضمانت نامه </span>
                                                                        <span class="profile-ud-value">
                                                                            {% if project.suretybond %}
                                                                                <a href="{{ project.suretybond.get_aboslute_url }}">مشاهده</a>
                                                                            {% else %}
                                                                                <span class="text-warning">ثبت نشده است</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">یادآور</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if project.reminderproject %}
                                                                                {{ project.reminderproject.time }}
                                                                                {% with remaining_time=project.reminderproject.get_remaining_time %}
                                                                                    <div class="badge badge-dim rounded-pill {% if remaining_time > -1 %}bg-success{% else %}bg-danger{% endif %}">
                                                                                        {{ remaining_time }}
                                                                                        روز مانده
                                                                                    </div>
                                                                                {% endwith %}
                                                                            {% else %}
                                                                                <span class="text-warning">ثبت نشده است</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">تعداد پرداختی ها</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if has_perm_to_financial_amount %}
                                                                                <span class="price-el">{{ project.get_payments.count }}</span>
                                                                            {% else %}
                                                                                <span>غیر قابل مشاهده</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">مبلغ پیش پرداخت</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if has_perm_to_financial_amount %}
                                                                                <span class="price-el">{{ project.get_total_prepayments_amount }}</span>
                                                                                تومان
                                                                            {% else %}
                                                                                <span>غیر قابل مشاهده</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">مبلغ پرداختی کل</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if has_perm_to_financial_amount %}
                                                                                <span class="price-el">{{ project.get_total_payments_amount }}</span>
                                                                                تومان
                                                                            {% else %}
                                                                                <span>غیر قابل مشاهده</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- .nk-block -->
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="warehouse">
                                                    <div class="card-inner">
                                                        <div class="nk-block">
                                                            <div class="nk-block-head">
                                                                <h5 class="title">امور انبار</h5>
                                                            </div>
                                                            <div class="profile-ud-list">
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">لیست ایتم ها</span>
                                                                        <span class="profile-ud-value">
                                                                            <a href="{% url 'dp_warehouse:item__list' %}?filter=true&project={{ project.id }}">مشاهده</a>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="profile-ud-item">
                                                                    <div class="profile-ud wider">
                                                                        <span class="profile-ud-label">مبلغ کل</span>
                                                                        <span class="profile-ud-value">
                                                                            {% if has_perm_to_warehouse_amount %}
                                                                                <span class="price-el">{{ project.get_total_warehouse_items_amount }}</span>
                                                                                تومان
                                                                            {% else %}
                                                                                <span>غیر قابل مشاهده</span>
                                                                            {% endif %}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- .nk-block -->
                                                    </div>
                                                </div>

                                                {% if has_perm_to_steps %}
                                                    <div class="tab-pane" id="steps">
                                                        <div class="card-inner">
                                                            <div class="nk-block">
                                                                <div class="nk-block-head nk-block-head-sm nk-block-between">
                                                                    <h5 class="title">مرحله ها</h5>
                                                                    <a data-bs-toggle="modal"
                                                                       data-bs-target="#modal-create-step-object"
                                                                       class="link link-sm"> افزودن مرحله +</a>
                                                                </div>
                                                            </div>
                                                            <!-- .nk-block -->
                                                            <div class="nk-block">
                                                                <div class="nk-tb-list nk-tb-ulist is-compact card">
                                                                    <div class="nk-tb-item nk-tb-head">
                                                                        <div class="nk-tb-col">
                                                                            <span class="sub-text">نام</span>
                                                                        </div>
                                                                        <div class="nk-tb-col">
                                                                            <span class="sub-text text-center">نوع ترافیک</span>
                                                                        </div>
                                                                        <div class="nk-tb-col tb-col-sm text-center">
                                                                            <span class="sub-text">پلن</span>
                                                                        </div>
                                                                        <div class="nk-tb-col tb-col-sm text-center">
                                                                            <span class="sub-text">درواقع</span>
                                                                        </div>
                                                                        <div class="nk-tb-col text-center">
                                                                            <span class="sub-text">وضعیت نهایی</span>
                                                                        </div>
                                                                    </div>
                                                                    {% for step in steps %}
                                                                        <div class="nk-tb-item">
                                                                            <div class="nk-tb-col">
                                                                                <a href="{{ step.get_absolute_url }}"><span
                                                                                        class="fw-bold">{{ step.name|truncatechars:35 }}</span></a>
                                                                            </div>
                                                                            <div class="nk-tb-col text-center">
                                                                                <span>{{ step.get_person_traffic_label }}</span>
                                                                            </div>
                                                                            <div class="nk-tb-col tb-col-sm text-center">
                                                                                <span class="badge badge-sm badge-dim bg-secondary">{{ step.plan }}</span>
                                                                            </div>
                                                                            <div class="nk-tb-col tb-col-sm text-center">
                                                                                <span class="badge badge-sm badge-dim bg-secondary">{{ step.actual|default:'-' }}</span>
                                                                            </div>
                                                                            <div class="nk-tb-col text-center">
                                                                                {% if step.get_status_result > -1 %}
                                                                                    <em class="icon ni ni-thumbs-up text-success"></em>
                                                                                {% elif step.get_status_result < 0 %}
                                                                                    <em class="icon ni ni-thumbs-down text-danger"></em>
                                                                                {% else %}
                                                                                    -
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                    {% empty %}
                                                                        <div class="container-not-found-base">
                                                                            <p>چیزی ثبت نشده است</p>
                                                                        </div>
                                                                    {% endfor %}
                                                                </div>
                                                                <!-- .nk-tb-list -->
                                                            </div>
                                                            <!-- .nk-block -->
                                                        </div>
                                                    </div>
                                                {% endif %}

                                                <div class="tab-pane" id="note">
                                                    <div class="card-inner">
                                                        <!-- .nk-block -->
                                                        <div class="nk-block">
                                                            <div class="nk-block-head nk-block-head-sm nk-block-between">
                                                                <h5 class="title mb-1">یاد داشت های شخصی</h5>
                                                                <a data-bs-toggle="modal"
                                                                   data-bs-target="#modal-create-note-object"
                                                                   class="link link-sm">+ افزودن یادداشت</a>
                                                            </div>
                                                            <!-- .nk-block-head -->
                                                            <div class="bq-note">
                                                                {% for note in notes %}
                                                                    <div class="bq-note-item">
                                                                        <div class="bq-note-text">
                                                                            <p>
                                                                                {{ note.text }}
                                                                            </p>
                                                                        </div>
                                                                        <div class="bq-note-meta">
                                                                            <span class="bq-note-added">اضافه شده در</span>
                                                                            <span class="datetime-convert"
                                                                                  dir="ltr">
                                                                                {{ note.get_created_at_date }}
                                                                            </span>
                                                                            <span class="fs-10px text-soft">({{ note.get_created_at_timepast }})</span>
                                                                            <span class="mx-1">|</span>
                                                                            <a href="{% url 'public:project_note__delete' note_id=note.id %}"
                                                                               class="link link-sm link-danger m-0">حذف
                                                                                یادداشت
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                    <!-- .bq-note-item -->
                                                                {% empty %}
                                                                    <div class="my-5 text-center ">
                                                                        <h6 class="text-soft">اولین یادداشت خود را
                                                                            بنویسید</h6>
                                                                    </div>
                                                                {% endfor %}
                                                            </div>
                                                            <!-- .bq-note -->
                                                        </div>
                                                        <!-- .nk-block -->
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- .card-inner -->
                                        </div>
                                        <!-- .card-content -->
                                        <div
                                                class="card-aside card-aside-right user-aside toggle-slide toggle-slide-right toggle-break-xxl"
                                                data-content="userAside"
                                                data-toggle-screen="xxl"
                                                data-toggle-overlay="true"
                                                data-toggle-body="true">
                                            <div class="card-inner-group" data-simplebar>
                                                <div class="card-inner">
                                                    <div class="user-card user-card-s2">
                                                        <div class="user-avatar lg"
                                                             style="background: none">
                                                            <img src="{{ project.get_image_cover_url }}"
                                                                 alt="{{ project.name }}" width="80"
                                                                 height="80">
                                                        </div>
                                                        <div class="user-info">
                                                            <div class="fs-10px p-1 px-2 badge badge-dim rounded-pill bg-dim-{{ project.status }}">
                                                                {{ project.get_status_label }}
                                                            </div>
                                                            <h5>
                                                                {{ project.name }}
                                                                {% if project.is_active %}
                                                                    <span class="text-success fs-14px">
                                                                        (فعال)
                                                                    </span>
                                                                {% else %}
                                                                    <span class="text-danger fs-14px">
                                                                        (غیر فعال)
                                                                    </span>
                                                                {% endif %}
                                                            </h5>
                                                            <span class="sub-text">
                                                                <a href="{{ project.task_master.get_absolute_url }}">{{ project.task_master.name }}</a>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .card-inner -->
                                                {% if has_perm_to_modify %}
                                                    <div class="card-inner card-inner-sm">
                                                        <ul class="btn-toolbar justify-center gx-1">
                                                            <li data-bs-toggle="modal"
                                                                data-bs-target="#modal-update-object">
                                                                <a
                                                                        class="btn btn-trigger btn-icon"
                                                                        data-bs-toggle="tooltip"
                                                                        data-bs-placement="bottom"
                                                                        title="ویرایش"><em
                                                                        class="icon ni ni-pen"></em></a>
                                                            </li>
                                                            <li>
                                                                <a href="#"
                                                                   class="btn btn-trigger btn-icon"
                                                                   data-bs-toggle="tooltip"
                                                                   data-bs-placement="bottom"
                                                                   title="خروجی"><em
                                                                        class="icon ni ni-download-cloud"></em></a>
                                                            </li>
                                                            <li data-bs-toggle="modal"
                                                                data-bs-target="#modal-delete-object">
                                                                <a
                                                                        class="btn btn-trigger btn-icon text-danger"
                                                                        data-bs-toggle="tooltip"
                                                                        data-bs-placement="bottom"
                                                                        title="حذف"><em
                                                                        class="icon ni ni-trash-empty"></em></a>

                                                            </li>
                                                        </ul>
                                                    </div>
                                                {% endif %}
                                                <!-- .card-inner -->
                                                <div class="card-inner">
                                                    <div class="overline-title-alt mb-2">وضعیت تسک ها</div>
                                                    <div class="profile-balance">
                                                        <div class="text-center">

                                                            <div class="badge badge-pill badge-dim bg-success">
                                                                تسک های تکمیل شده
                                                                <b>({{ project.get_tasks_finished.count }})</b>
                                                            </div>

                                                            <div class="badge badge-pill badge-dim bg-warning">
                                                                تسک های در صف
                                                                <b>({{ project.get_tasks_queue.count }})</b>
                                                            </div>

                                                            <div class="badge badge-pill badge-dim bg-primary">
                                                                تسک های در حال انجام
                                                                <b>({{ project.get_tasks_progress.count }})</b>
                                                            </div>

                                                            <div class="badge badge-pill badge-dim bg-gray">
                                                                تسک های نگه داشته شده
                                                                <b>({{ project.get_tasks_hold.count }})</b>
                                                            </div>

                                                            <div class="badge badge-pill badge-dim bg-danger">
                                                                نیاز به بررسی
                                                                <b>({{ project.get_tasks_need_to_check.count }})</b>
                                                            </div>

                                                            <div class="badge badge-pill badge-dim bg-dark">
                                                                نیاز به برنامه ریزی
                                                                <b>({{ project.get_tasks_need_to_replan.count }})</b>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .card-inner -->
                                                <div class="card-inner">
                                                    <div class="row text-center">
                                                        <div class="col-4">
                                                            <div class="profile-stats">
                                                                <span class="amount"
                                                                      title="{{ project.get_last_step.name|default:'-' }}">
                                                                    <a href="{{ project.get_last_step.get_absolute_url }}"
                                                                       class="badge badge-dim bg-secondary fs-13px mb-1">{{ project.get_last_step.name|default:'-'|truncatechars:10 }}</a>
                                                                </span>
                                                                <span class="sub-text">مرحله</span>
                                                            </div>
                                                        </div>

                                                        <div class="col-4">
                                                            <div class="profile-stats">
                                                                <span class="amount">{{ project.get_tasks.count }}</span>
                                                                <span class="sub-text">کل تسک ها</span>
                                                            </div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="profile-stats">
                                                                <span class="amount">{{ project.progress_percentage }}%</span>
                                                                <span class="sub-text">درصد پیشرفت </span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                <!-- .card-inner -->
                                                <div class="card-inner">
                                                    <h6 class="overline-title-alt mb-2">زمان ها</h6>
                                                    <div class="row g-3">
                                                        <div class="col-6">
                                                            <span class="sub-text">زمان باقی مانده تا تحویل انبوه:</span>
                                                            <span>{{ project.get_remaining_mass_delivery }} روز </span>
                                                        </div>
                                                        <div class="col-6">
                                                            <span class="sub-text">زمان باقی مانده تا تحویل نمونه:</span>
                                                            <span>{{ project.get_remaining_sample_delivery }} روز </span>
                                                        </div>
                                                        <div class="col-6">
                                                            <span class="sub-text">زمان باقی مانده تا اتمام قرارداد:</span>
                                                            <span>{{ project.get_remaining_time_end }} روز </span>
                                                        </div>
                                                        <div class="col-6">
                                                            <span class="sub-text">زمان ایجاد پروژه:</span>
                                                            <span>{{ project.get_created_at_timepast }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .card-inner -->
                                                <div class="card-inner">
                                                    <h6 class="overline-title-alt mb-3">
                                                        واحد های
                                                        مشارکت کننده</h6>
                                                    <ul class="g-1">
                                                        {% for department in project.get_participating_departments %}
                                                            <li class="btn-group">
                                                                <a class="btn btn-xs btn-light btn-dim"
                                                                   href="{{ department.get_absolute_url }}">{{ department.name }}</a>
                                                            </li>
                                                        {% empty %}
                                                            <div class="container-not-found-base">
                                                                <p>چیزی یافت نشد</p>
                                                            </div>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                                <!-- .card-inner -->
                                            </div>
                                            <!-- .card-inner -->
                                        </div>
                                        <!-- .card-aside -->
                                    </div>
                                    <!-- .card-aside-wrap -->
                                </div>
                                <!-- .card -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content @e -->
                <!-- footer @s -->
                {% include 'base/components/footer.html' %}
                <!-- footer @e -->
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
        <!-- modals -->
        <div class="modal fade" tabindex="-1" id="modal-delete-object" aria-modal="true" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-body modal-body-lg text-center">
                        <div class="nk-modal">
                            <em class="nk-modal-icon icon icon-circle icon-circle-xxl ni ni-trash-empty bg-danger"></em>
                            <h4 class="nk-modal-title">حذف پروژه</h4>
                            <div class="nk-modal-text">
                                <p class="bg-outline-danger">
                                    ایا از حذف پروژه
                                    <b>{{ project.name }}</b>
                                    اطمینان دارید ؟ با حذف پروژه تمام موارد مربوطه به ان از جمله فایل ها ، تسک ها و ..
                                    حذف خواهند شد و امکان بازگشت وجود ندارد
                                </p>
                            </div>
                            <div class="nk-modal-action mt-5">
                                <a class="btn btn-lg btn-mw btn-light m-1" data-bs-dismiss="modal">لغو</a>
                                <a href="{% url 'public:project__delete' project_id=project.id %}"
                                   class="btn btn-lg btn-mw btn-danger m-1">بله ، حذف پروژه</a>
                            </div>
                        </div>
                    </div>
                    <!-- .modal-body -->
                </div>
            </div>
        </div>
        <div class="modal fade" tabindex="-1" id="modal-update-object">
            <div class="modal-dialog modal-dialog-top" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-dismiss="modal" aria-label="بستن">
                        <em class="icon ni ni-cross"></em>
                    </a>
                    <div class="modal-header">
                        <h5 class="modal-title">تغییر پروژه</h5>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'public:project__update' project_id=project.id %}"
                              class="form-validate is-alter" method="post">
                            {% csrf_token %}
                            <div class="row g-4">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="number_id">شماره
                                            درخواست</label>
                                        <div class="form-control-wrap">
                                            <input type="text" class="form-control" name="number_id"
                                                   id="number_id"
                                                   value="{{ project.number_id|default:'' }}"
                                                   placeholder="1234">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="name_project">نام</label>
                                        <div class="form-control-wrap">
                                            <input type="text" class="form-control" name="name"
                                                   placeholder="نام پروژه"
                                                   id="name_project" required value="{{ project.name|default:'' }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="client_user">مشتری</label>
                                        <div class="form-control-wrap">
                                            <select id="client_user" name="task_master"
                                                    class="form-select js-select2 select-by-value"
                                                    value="{{ project.task_master.id }}" data-search="on"
                                                    tabindex="-1" aria-hidden="true" required>
                                                {% for task_master in task_masters %}
                                                    <option value="{{ task_master.id }}">{{ task_master.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="time_start">تاریخ ابلاغ به
                                            کار</label>
                                        <div class="form-control-wrap">
                                            <input type="text" name="time_start" id="time_start"
                                                   class="form-control date-picker-alt"
                                                   placeholder="روز-ماه-سال" readonly data-date-format='yyyy-mm-d'
                                                   value="{{ project.time_start|default:'' }}">
                                        </div>
                                        <div class="form-note">فرمت تاریخ <code>روز-ماه-سال</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="time_end">تاریخ اتمام
                                            قرارداد</label>
                                        <div class="form-control-wrap">
                                            <input type="text" name="time_end" id="time_end"
                                                   class="form-control date-picker-alt"
                                                   placeholder="روز-ماه-سال" readonly
                                                   value="{{ project.time_end|default:'' }}">
                                        </div>
                                        <div class="form-note">فرمت تاریخ <code>روز-ماه-سال</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="is_paid">وضعیت
                                            پرداخت</label>
                                        <div class="form-control-wrap">
                                            <select name="is_paid" id="is_paid"
                                                    class="form-select js-select2 select-by-value"
                                                    value="{{ project.is_paid }}">
                                                <option value="false">پرداخت نشده</option>
                                                <option value="true">پرداخت شده</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="prepayment_datetime">تاریخ
                                            پیش پرداخت</label>
                                        <div class="form-control-wrap">
                                            <input type="text" name="prepayment_datetime"
                                                   id="prepayment_datetime"
                                                   class="form-control date-picker-alt"
                                                   placeholder="روز-ماه-سال" readonly
                                                   value="{{ project.prepayment_datetime|default:'' }}">
                                        </div>
                                        <div class="form-note">فرمت تاریخ <code>روز-ماه-سال</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="count_total">تعداد کل</label>
                                        <div class="form-control-wrap">
                                            <input type="number" class="form-control"
                                                   name="count_total"
                                                   placeholder="تعداد کل"
                                                   id="count_total" required
                                                   value="{{ project.count_total|default:'' }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="count_remaining">تعداد باقی
                                            مانده</label>
                                        <div class="form-control-wrap">
                                            <input type="number" class="form-control"
                                                   name="count_remaining"
                                                   placeholder="تعداد باقی مانده"
                                                   id="count_remaining" required
                                                   value="{{ project.count_remaining|default:'' }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="status">وضعیت
                                            پرداخت</label>
                                        <div class="form-control-wrap">
                                            <select name="status" id="status"
                                                    class="form-select js-select2 select-by-value"
                                                    value="{{ project.status|default:'' }}">
                                                <option value="checking" selected="">در حال بررسی
                                                    قبل اجرا
                                                </option>
                                                <option value="under_construction">در حال ساخت
                                                </option>
                                                <option value="posted">ارسال شده</option>
                                                <option value="paused">متوقف شده</option>
                                                <option value="completed">تایید و اتمام</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="mass_delivery_date">تاریخ
                                            تحویل انبوه</label>
                                        <div class="form-control-wrap">
                                            <input type="text" name="mass_delivery_date"
                                                   id="mass_delivery_date"
                                                   class="form-control date-picker-alt"
                                                   placeholder="روز-ماه-سال" readonly
                                                   value="{{ project.mass_delivery_date|default:'' }}">
                                        </div>
                                        <div class="form-note">فرمت تاریخ <code>روز-ماه-سال</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="price">قیمت</label>
                                        <div class="form-control-wrap">
                                            <input type="number" name="price"
                                                   id="price"
                                                   class="form-control"
                                                   placeholder="قیمت" value="{{ project.price|default:'' }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label"
                                               for="count_remaining">نمونه</label>
                                        <div class="form-control-wrap text-center">
                                            <ul class="custom-control-group">
                                                <li>
                                                    <div class="custom-control custom-control-sm custom-radio custom-control-pro">
                                                        <input type="radio"
                                                               class="custom-control-input"
                                                               value="false"
                                                               name="has_sample" id="btnRadio1"
                                                               oninput="toggleRelatedField('sample_date_cnt', false)"
                                                               {% if not project.has_sample %}checked{% endif %}>
                                                        <label class="custom-control-label"
                                                               for="btnRadio1">ندارد</label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="custom-control custom-control-sm custom-radio custom-control-pro">
                                                        <input type="radio"
                                                               class="custom-control-input"
                                                               value="true"
                                                               name="has_sample" id="btnRadio2"
                                                               oninput="toggleRelatedField('sample_date_cnt', true)"
                                                               {% if project.has_sample %}checked{% endif %}>
                                                        <label class="custom-control-label"
                                                               for="btnRadio2">دارد</label>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 {% if not project.has_sample %}d-none{% endif %}"
                                     id="sample_date_cnt">
                                    <div class="form-group">
                                        <label class="form-label" for="sample_delivery_date">تاریخ
                                            تحویل نمونه</label>
                                        <div class="form-control-wrap">
                                            <input type="text" name="sample_delivery_date"
                                                   id="sample_delivery_date"
                                                   class="form-control date-picker-alt"
                                                   placeholder="روز-ماه-سال" readonly
                                                   value="{{ project.sample_delivery_date|default:'' }}">
                                        </div>
                                        <div class="form-note">فرمت تاریخ <code>روز-ماه-سال</code>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="item">ایتم پروژه</label>
                                        <div class="form-control-wrap">
                                                                <textarea name="item" id="item"
                                                                          class="form-control"
                                                                          placeholder="ایتم پروژه">{{ project.item }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-label" for="description">توضیحات</label>
                                        <div class="form-control-wrap">
                                                                <textarea name="description" id="description"
                                                                          class="form-control"
                                                                          placeholder="توضیحات">{{ project.description }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="progress_percentage">درصد پیشرفت</label>
                                        <div class="form-control-wrap">
                                            <input type="number" class="form-control"
                                                   name="progress_percentage"
                                                   placeholder="درصد پیشرفت"
                                                   id="progress_percentage" required
                                                   value="{{ project.progress_percentage }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 text-left">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-lg btn-primary">
                                            بروزرسانی پروژه
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" tabindex="-1" id="modal-create-note-object">
            <div class="modal-dialog modal-dialog-top" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-dismiss="modal" aria-label="بستن">
                        <em class="icon ni ni-cross"></em>
                    </a>
                    <div class="modal-header">
                        <h5 class="modal-title">افزودن یادداشت شخصی</h5>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'public:project_note__add' %}"
                              class="form-validate is-alter" method="post">
                            <input type="hidden" name="project" value="{{ project.id }}">
                            {% csrf_token %}
                            <div class="row g-4">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="description">توضیحات</label>
                                        <div class="form-control-wrap">
                                            <textarea name="text" id="text"
                                                      class="form-control" required
                                                      placeholder="یادداشت خود را بنویسید"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 text-left">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-lg btn-primary">
                                            ایجاد یادداشت
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" tabindex="-1" id="modal-create-step-object">
            <div class="modal-dialog modal-dialog-top" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-dismiss="modal" aria-label="بستن">
                        <em class="icon ni ni-cross"></em>
                    </a>
                    <div class="modal-header">
                        <h5 class="modal-title">ایجاد مرحله</h5>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'public:project_step__add' %}"
                              class="form-validate is-alter" method="post">
                            <input type="hidden" name="project" value="{{ project.id }}">
                            {% csrf_token %}
                            <div class="row g-4">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="name">نام</label>
                                        <div class="form-control-wrap">
                                            <input name="name" id="name"
                                                   class="form-control"
                                                   placeholder="نام" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="person_traffic">نوع ترافیک کاری</label>
                                        <div class="form-control-wrap">
                                            <select name="person_traffic" id="person_traffic"
                                                    class="form-control js-select2">
                                                <option value="person/day">نفر/روز</option>
                                                <option value="person/hour">نفر/ساعت</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="plan">پلن</label>
                                        <div class="form-control-wrap">
                                            <input type="number" name="plan" id="plan"
                                                   class="form-control"
                                                   placeholder="پلن" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="actual">در واقع</label>
                                        <div class="form-control-wrap">
                                            <input type="number" name="actual" id="actual"
                                                   class="form-control"
                                                   placeholder="در واقع">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label" for="description">توضیحات</label>
                                        <div class="form-control-wrap">
                                            <textarea name="text" id="text"
                                                      class="form-control"
                                                      placeholder="توضیحات"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 text-left">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-lg btn-primary">
                                            ایجاد مرحله
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- end modals -->
    </div>
{% endblock %}

{% block Script %}
    <script>
        document.querySelectorAll('.bg-dim-checking').forEach(function (e) {
            e.classList.add('bg-outline-warning')
        })

        document.querySelectorAll('.bg-dim-under_construction').forEach(function (e) {
            e.classList.add('bg-outline-primary')
        })

        document.querySelectorAll('.bg-dim-posted').forEach(function (e) {
            e.classList.add('bg-outline-info')
        })

        document.querySelectorAll('.bg-dim-completed').forEach(function (e) {
            e.classList.add('bg-outline-success')
        })

        document.querySelectorAll('.bg-dim-paused').forEach(function (e) {
            e.classList.add('bg-outline-danger')
        })

        // charts
        function chart_step() {

            function chart(cnv) {
                let options = {
                    responsive: true,
                    // maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                        },
                    },
                    borderRadius: 5,
                    indexAxis: 'y',
                };
                let data_chart = JSON.parse(cnv.getAttribute('data-chart'))
                // check empty
                if (data_chart.length != 0) {
                    let labels = []
                    let data_plan = []
                    let data_actual = []
                    for (let i of data_chart) {
                        labels.push(i['name'])
                        data_plan.push(i['plan'])
                        data_actual.push(i['actual'])
                    }
                    let data = {
                        labels: labels,
                        datasets: [
                            {
                                label: 'پلن',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 1,
                                data: data_plan
                            },
                            {
                                label: 'درواقع',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1,
                                data: data_actual
                            }
                        ]
                    };
                    let ctx = cnv.getContext('2d')
                    new Chart(ctx, {
                        type: 'bar',
                        data: data,
                        options: options
                    })
                } else {
                    cnv.parentElement.style.display = 'none'
                }

            }

            chart(document.getElementById('chart_step_1'))
            chart(document.getElementById('chart_step_2'))
        }

        chart_step()

    </script>
{% endblock %}