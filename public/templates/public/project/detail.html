{% extends 'base/base_template.html' %}
{% load static %}

{% block Title %}
    جزئیات پروژه
{% endblock %}

{% block Link %}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" href="{% static 'frontend/styles/project.css' %}"/>

    <style>
        .group-form {
            margin: 10px 2px;
        }

        .group-form label {
            direction: ltr;
            margin-bottom: 10px;
        }
    </style>
{% endblock %}

{% block Content %}

    <!-- modal delete project -->
    <div class="modal fade" id="project-modal-delete" tabindex="-1"
         aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"
                        id="exampleModalLabel">حذف پروژه</h5>
                </div>
                <div class="modal-body">
                    ایا از حذف پروژه
                    <strong>{{ project.name|truncatechars:30 }}</strong>
                    اطمینان دارید ؟
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">لغو
                    </button>
                    <form action="{% url 'public:project_delete' project_id=project.id %}"
                          method="get">
                        <button class="btn-item m-1 remov btn btn-danger">
                            بله ، حذف پروژه
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- end modal delete project -->


    <main class="main content-page container">
        <div class="d-flex align-items-center">
            <h5 class="title-page mx-auto">{{ project.name }}</h5>
            <a href="{{ user.get_absolute_url_dashboard }}" class="btn btn-danger text-center ms-1">بازگشت</a>
        </div>
        <section class="col-12 project-content">
            <div class="inner-project">
                <!-- btn tab page -->
                <div class="btn-content d-flex justify-content-between border-bottom border-secondary border-1">
                    <div class="btns col-12 col-md-7">
                        <div class="btn-change col-2 text-center active">مشخصات پروژه</div>
                        <div class="btn-change col-2 text-center">لیست انبار</div>
                        <div class="btn-change col-2 text-center">اسناد آپلود شده</div>
                        <div class="btn-change col-2 text-center d-none">بازرگانی</div>
                        <div class="btn-change col-2 text-center">مکاتبات پروژه</div>
                        <div class="btn-change col-2 text-center">امور مالی</div>
                        {% if project.inquiry %}
                            <div class="btn-change col-2 text-center">استعلام مربوطه</div>
                        {% endif %}
                    </div>
                    {% if has_perm_to_modify %}
                        <div>
                            <button class="btn btn-outline-primary text-center mx-1 p-2 px-4" data-bs-toggle="modal"
                                    data-bs-target="#project-edit">ویرایش
                            </button>
                            <button type="button"
                                    class="btn btn-item m-1 remov btn btn-outline-danger text-center p-2 px-4"
                                    data-bs-toggle="modal"
                                    data-bs-target="#project-modal-delete">
                                حذف
                            </button>
                        </div>
                    {% endif %}

                </div>
                <!-- btn tab page -->

                <section class="content-notifcation">
                    <!-- Project-specifications chart and name ddline  -->
                    <div class="Project-specifications">
                        <div class="col-12 col-md-8 d-flex flex-column justify-content-center align-items-start">
                            <div class="right">
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>وضعیت:</span>
                                        <span><b>{{ project.get_status_display }}</b></span>
                                    </div>
                                </div>
                                {% if project.inquiry %}
                                    <div class="col-12 col-md-6 p-2">
                                        <div class="right-item">
                                            <span>استعلام:</span>
                                            <span>
                                                <a href="{{ project.inquiry.get_absolute_url }}">مشاهده</a>
                                            </span>
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>شماره درخواست:</span>
                                        <span>{{ project.number_id }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>نام پروژه:</span>
                                        <span>{{ project.name }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>کارفرما:</span>
                                        <span>{{ project.task_master }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تاریخ شروع:</span>
                                        <span class="datetime-convert">{{ project.time_start }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تاریخ پایان</span>
                                        <span class="datetime-convert">{{ project.time_end }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>قیمت:</span>
                                        {% if has_perm_to_modify %}
                                            <span class="price-el">{{ project.price|default:'بدون قیمت' }}</span>
                                        {% else %}
                                            غیر قابل مشاهده
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span> وضعیت پرداخت :</span>
                                        <span>{% if project.is_paid %}پرداخت شده است{% else %}پرداخت نشده
                                            است{% endif %}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تاریخ پیش پرداخت</span>
                                        <span class="datetime-convert">{{ project.get_prepayment_datetime }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تعداد کل :</span>
                                        <span class="price-el">{{ project.count_total }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تعداد باقی مانده :</span>
                                        <span class="price-el">{{ project.count_remaining }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>آیتم :</span>
                                        <span>{{ project.item|default:'چیزی ثبت نشده است' }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>نمونه :</span>
                                        <span class="datetime-convert">{{ project.get_has_sample_state }}</span>
                                    </div>
                                </div>
                                {% if project.has_sample %}
                                    <div class="col-12 col-md-6 p-2">
                                        <div class="right-item">
                                            <span>تاریخ تحویل نمونه :</span>
                                            <span class="datetime-convert">
                                                    {{ project.get_sample_delivery_date }}
                                            </span>
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>تاریخ تحویل انبوه :</span>
                                        <span class="datetime-convert">{{ project.get_mass_delivery_date }}</span>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>درصد پیشرفت</span>
                                        <div class="mt-3 text-primary">{{ project.get_progress_percentage }}%</div>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 p-2">
                                    <div class="right-item">
                                        <span>توضیحات:</span>
                                        <div class="mt-3">{{ project.description|default:'توضیحی ثبت نشده است' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- chart left -->
                        <div id="cnt-chart" class="col-12 col-md-4 chart-section">
                            <canvas id="chart"></canvas>
                        </div>
                        <!-- chart left -->
                    </div>
                    <!-- Project-specifications chart and name ddline  -->

                    <!--start content list task -->
                    <div class="content-items p-2 active">
                        <div class="mt-2">
                            <form action="" method="get" class="d-flex justify-content-center align-items-center">
                                <div class="cnt-search col-11 col-md-7">
                                    <input type="text" name="task_q" value="{{ request.GET.task_q }}" placeholder="نام تسک ، واحد تسک و ..">
                                    <button>
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                        <section class="section-table">
                            <h6 class="title-page">لیست تسک ها</h6>
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            نام تسک
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            وضعیت
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            آخرین تغییر
                                        </div>
                                    </div>
                                    <div class="col-md-2 col-1">
                                        <div class="table-title-item">
                                            از واحد
                                        </div>
                                    </div>
                                    <div class="col-md-2 col-1">
                                        <div class="table-title-item">
                                            برای واحد
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            الویت
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            تاریخ شروع
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            تاریخ پایان
                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    {% for task in project_tasks %}
                                        <div class="row-table">
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ task.name }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="status">
                                                    {{ task.get_state_label }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2 d-flex align-items-center">
                                                <div class="table-content-item datetime-convert">
                                                    {{ task.get_state_modify_time|default:'-' }}
                                                </div>
                                                <span class="font-80">
                                                    ({{ task.state_modify_time|date:'H:i' }})
                                                </span>
                                            </div>
                                            <div class="col-md-2 col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ task.from_department }}
                                                </div>
                                            </div>
                                            <div class="col-md-2 col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ task.to_department }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ task.priority }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ task.get_time_start|default:'-' }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ task.get_time_end|default:'-' }}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    </div>
                    <!--end content list task -->

                    <!--start List of raw materials -->
                    <div class="content-items p-2">
                        <section class="section-table">
                            <h6 class="title-page">لیست انبار</h6>
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="table-title-item">
                                            قیمت
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="table-title-item">
                                            توضیحات
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            فایل اصلی
                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    {% for item in project.get_warehouse_registrations %}
                                        {% include 'warehouse/components/registration_des.html' %}

                                        <div class="row-table">
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <div class="col-3 p-2">
                                                <div class="table-content-item spread-price">
                                                    {{ item.price|default:'ندارد' }}
                                                </div>
                                            </div>
                                            <div class="col-3 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ item.get_register_time }}
                                                </div>
                                            </div>
                                            <div class="col-3 p-2">
                                                <div class="table-content-item" data-bs-target="#registrationDescription-{{ item.id }}" data-bs-toggle="modal">
                                                    {{ item.description|truncatechars:'32'|default:'-' }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {% if item.file %}
                                                        <a href="{{ item.get_file_url }}" class="text-info fw-bold" download>دریافت</a>
                                                    {% else %}
                                                        <a class="fw-bold">ندارد</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    </div>
                    <!--end List of raw materials -->

                    <!--start Uploaded documents -->
                    <div class="content-items p-2">
                        <div class="text-left my-3">
                            <a class="btn btn-info text-white"
                               href="{% url 'public:project_detail_file_list' project_id=project.id %}">مشاهده همه</a>
                        </div>
                        <section class="section-table">
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            نام
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            واحد فرستنده
                                        </div>
                                    </div>
                                    <div class="col-5">
                                        <div class="table-title-item">
                                            توضیحات
                                        </div>
                                    </div>

                                    <div class="col-2">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            فایل
                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    {% for file in project.get_files %}
                                        <div class="row-table">
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ file.name }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ file.from_department.name|default:'-' }}
                                                </div>
                                            </div>
                                            <div class="col-5 p-2">
                                                <div class="table-content-item">
                                                    <span class="description">
                                                        {{ file.description }}
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="col-2 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ file.get_created_at }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {% if file.get_file_url %}
                                                        <a href="{{ file.get_file_url }}" download class="btn-table">دانلود</a>
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    </div>
                    <!--end Uploaded documents -->

                    <!-- start Commerce -->
                    <div class="content-items p-2">
                        <section class="section-table">
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            فرستنده
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="table-title-item">
                                            توضیحات
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">

                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    <div class="row-table">
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                1
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                نام و نام خانوادگی
                                            </div>
                                        </div>
                                        <div class="col-6 p-2">
                                            <div class="table-content-item">
                                                <span class="description"> لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ</span>
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                1388/8/5
                                            </div>
                                        </div>
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                <div class="btn-table">دانلود</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row-table">
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                1
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                نام و نام خانوادگی
                                            </div>
                                        </div>
                                        <div class="col-6 p-2">
                                            <div class="table-content-item">
                                                <span class="description"> لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ</span>
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                1388/8/5
                                            </div>
                                        </div>
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                <div class="btn-table">دانلود</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row-table">
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                1
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                نام و نام خانوادگی
                                            </div>
                                        </div>
                                        <div class="col-6 p-2">
                                            <div class="table-content-item">
                                                <span class="description"> لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ</span>
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                1388/8/5
                                            </div>
                                        </div>
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                <div class="btn-table">دانلود</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row-table">
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                1
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                نام و نام خانوادگی
                                            </div>
                                        </div>
                                        <div class="col-6 p-2">
                                            <div class="table-content-item">
                                                <span class="description"> لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ</span>
                                            </div>
                                        </div>
                                        <div class="col-2 p-2">
                                            <div class="table-content-item">
                                                1388/8/5
                                            </div>
                                        </div>
                                        <div class="col-1 p-2">
                                            <div class="table-content-item">
                                                <div class="btn-table">دانلود</div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </section>
                    </div>
                    <!--end Commerce -->

                    <!-- ticket -->
                    <div class="content-items p-2">
                        <section class="section-table">
                            <p class="pt-3" style="text-align: right">تیکت‌ها</p>
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            واحد فرستنده
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="table-title-item">
                                            متن تیکت
                                        </div>
                                    </div>

                                    <div class="col-2">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            فایل
                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    {% for ticket in project.get_tickets %}
                                        <div class="row-table">
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ ticket.from_department.name }}
                                                </div>
                                            </div>
                                            <div class="col-6 p-2">
                                                <div class="table-content-item">
                                                    <span class="description">
                                                        {{ ticket.description }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ ticket.get_created_at }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {% if ticket.get_file_url %}
                                                        <a href="{{ ticket.get_file_url }}" download=""
                                                           class="btn-table">دانلود</a>
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <p class="pt-3" style="text-align: right">اعلانات</p>
                            <div class="table">
                                <div class="table-title">
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            واحد فرستنده
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            عنوان
                                        </div>
                                    </div>
                                    <div class="col-5">
                                        <div class="table-title-item">
                                            متن اعلان
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            اولویت
                                        </div>
                                    </div>
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            فایل
                                        </div>
                                    </div>
                                </div>
                                <div class="table-content">
                                    {% for notif in project.get_notifications %}
                                        <div class="row-table">
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ notif.from_department.name }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    <span class="description">
                                                        {{ notif.get_title|truncatechars:24 }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-5 p-2">
                                                <div class="table-content-item">
                                                    <span class="description">
                                                        {{ notif.description|truncatechars:86 }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ notif.get_created_at }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ notif.priority }}
                                                </div>
                                            </div>
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {% if notif.get_file_url %}
                                                        <a href="{{ notif.get_file_url }}" download=""
                                                           class="btn-table">دانلود</a>
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    </div>
                    <!-- ticket -->

                    <!-- financial department -->
                    <div class="content-items p-2">
                        <section class="section-table">
                            <p style="text-align: right">پرداختی ها</p>
                            <div class="table">
                                <!-- start title table -->
                                <div class="table-title">
                                    <!-- each column title table -->
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <!-- each column title table -->
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            نوع
                                        </div>
                                    </div>
                                    <div class="col-5">
                                        <div class="table-title-item">
                                            مبلغ
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            کدرهگیری
                                        </div>
                                    </div>

                                </div>
                                <!-- end title table -->
                                <!-- start content table -->
                                <div class="table-content">
                                    {% for payment in project.get_payments %}
                                        <div class="row-table">
                                            <!-- each column content table -->
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <!-- each column content table -->
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ payment.get_type_payment_label }}
                                                </div>
                                            </div>
                                            <div class="col-5 p-2">
                                                <div class="table-content-item spread-price">
                                                    {{ payment.price }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ payment.get_created_at }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ payment.tracking_code }}
                                                </div>
                                            </div>

                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                                <!-- start content table -->
                            </div>

                            <p style="text-align: right">پیش پرداختی ها</p>
                            <div class="table">
                                <!-- start title table -->
                                <div class="table-title">
                                    <!-- each column title table -->
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <!-- each column title table -->
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            نوع
                                        </div>
                                    </div>
                                    <div class="col-5">
                                        <div class="table-title-item">
                                            مبلغ
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            تاریخ
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            کدرهگیری
                                        </div>
                                    </div>

                                </div>
                                <!-- end title table -->
                                <!-- start content table -->
                                <div class="table-content">
                                    {% for payment in project.get_prepayments %}
                                        <div class="row-table">
                                            <!-- each column content table -->
                                            <div class="col-1 p-2">
                                                <div class="table-content-item">
                                                    {{ forloop.counter }}
                                                </div>
                                            </div>
                                            <!-- each column content table -->
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ payment.get_type_payment_label }}
                                                </div>
                                            </div>
                                            <div class="col-5 p-2">
                                                <div class="table-content-item spread-price">
                                                    {{ payment.price }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item datetime-convert">
                                                    {{ payment.get_created_at }}
                                                </div>
                                            </div>
                                            <div class="col-2 p-2">
                                                <div class="table-content-item">
                                                    {{ payment.tracking_code }}
                                                </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                                <!-- start content table -->
                            </div>
                        </section>
                    </div>
                    <!-- financial department -->

                    <!-- inquiry content -->
                    <div class="content-items p-2">
                        <section class="section-table">
                            <p style="text-align: right">فایل های استعلام</p>
                            <div class="table">
                                <!-- start title table -->
                                <div class="table-title">
                                    <!-- each column title table -->
                                    <div class="col-1">
                                        <div class="table-title-item">
                                            ردیف
                                        </div>
                                    </div>
                                    <!-- each column title table -->
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            نام
                                        </div>
                                    </div>
                                    <div class="col-5">
                                        <div class="table-title-item">
                                            توضیحات
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="table-title-item">
                                            فایل
                                        </div>
                                    </div>
                                </div>
                                <!-- end title table -->
                                <!-- start content table -->
                                <div class="table-content">
                                    {% for inquiry_file in project.inquiry.get_files %}
                                        {% if user.department.id in inquiry_file.get_department_ids %}
                                            <div class="row-table">
                                                <!-- each column content table -->
                                                <div class="col-1 p-2">
                                                    <div class="table-content-item">
                                                        {{ forloop.counter }}
                                                    </div>
                                                </div>
                                                <!-- each column content table -->
                                                <div class="col-2 p-2">
                                                    <div class="table-content-item">
                                                        {{ inquiry_file.name }}
                                                    </div>
                                                </div>
                                                <div class="col-5 p-2">
                                                    <div class="table-content-item spread-price">
                                                        {{ inquiry_file.description }}
                                                    </div>
                                                </div>
                                                <div class="col-2 p-2">
                                                    <div class="table-content-item">
                                                        {% if inquiry_file.get_file_url %}
                                                            <a href="{{ inquiry_file.get_file_url }}"
                                                               download>دانلود</a>
                                                        {% else %}
                                                            -
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% empty %}
                                        <div class="container-not-found-base">
                                            <p>چیزی یافت نشد</p>
                                        </div>
                                    {% endfor %}
                                </div>
                                <!-- start content table -->
                            </div>
                        </section>
                    </div>
                    <!-- inquiry content end -->
                </section>
            </div>
        </section>
    </main>


    <!-- Modal -->
    <div class="modal fade" id="project-edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <form action="{% url 'public:project_update' project_id=project.id %}" method="post">
                {% csrf_token %}
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">ویرایش پروژه</h5>
                    </div>
                    <div class="modal-body">
                        <div class="col-12">
                            <div class="group-form">
                                <label for="number_id"> :شماره درخواست</label>
                                <input type="text" id="number_id" class="form-control" name="number_id" required
                                       value="{{ project.number_id }}">
                            </div>
                            <div class="group-form">
                                <label for="name">نام</label>
                                <input type="text" id="name" class="form-control" name="name" required
                                       value="{{ project.name }}">
                            </div>
                            <div class="group-form">
                                <label for="task_master">کارفرما</label>
                                <select class="form-select text-end" name="task_master" id="task_master" required>
                                    {% for task_master in task_masters %}
                                        <option value="{{ task_master.id }}">{{ task_master.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="group-form">
                                <label for="time_start_picker">تاریخ شروع</label>
                                <input type="text" name="" id="time_start_picker"
                                       class="form-control persianDatapicker" set-on="time_start"
                                       required readonly value="{{ project.get_time_start_input }}">
                                <input type="hidden" id="time_start" name="time_start" required
                                       value="{{ project.get_time_start_input }}">
                            </div>
                            <div class="group-form">
                                <label for="time_end_picker">تاریخ پایان</label>
                                <input type="text" name="" id="time_end_picker"
                                       class="form-control persianDatapicker" set-on="time_end"
                                       required readonly value="{{ project.get_time_end_input }}">
                                <input type="hidden" id="time_end" name="time_end" required
                                       value="{{ project.get_time_end_input }}">
                            </div>
                            <div class="group-form">
                                <label for="price">قیمت</label>
                                <input type="number" id="price" class="form-control" name="price"
                                       value="{{ project.price }}">
                            </div>
                            <div class="group-form">
                                <label for="">وضعیت</label>
                                <select name="status" class="form-control form-select" required>
                                    <option value="checking"
                                            {% if project.status == 'checking' %}selected{% endif %}>در حال
                                        بررسی قبل اجرا
                                    </option>
                                    <option value="under_construction"
                                            {% if project.status == 'under_constration' %}selected{% endif %}>در حال
                                        ساخت
                                    </option>
                                    <option value="posted"
                                            {% if project.status == 'posted' %}selected{% endif %}>
                                        ارسال شده
                                    </option>
                                    <option value="completed"
                                            {% if project.status == 'completed' %}selected{% endif %}>
                                        تایید و اتمام
                                    </option>
                                    <option value="paused" {% if project.status == 'paused' %}selected{% endif %}>متوقف
                                        شده
                                    </option>
                                </select>
                            </div>
                            <div class="group-form">
                                <label for="price">وضعیت پرداخت</label>
                                <select name="is_paid" id="" required class="form-control form-select">
                                    <option value="false" {% if not project.is_paid %}selected{% endif %}>پرداخت نشده
                                    </option>
                                    <option value="true" {% if project.is_paid %}selected{% endif %}>پرداخت شده</option>
                                </select>
                            </div>

                            <div class="group-form">
                                <label for="prepayment_datetime_picker"> :تاریخ پیش پرداخت</label>
                                <input type="text" name="" id="prepayment_datetime_picker"
                                       class="form-control persianDatapicker" set-on="prepayment_datetime"
                                       required readonly value="{{ project.get_prepayment_datetime_input }}">
                                <input type="hidden" id="prepayment_datetime" name="prepayment_datetime" required
                                       value="{{ project.get_prepayment_datetime_input }}">

                            </div>
                            <div class="group-form">
                                <label for="item">آیتم</label>
                                <textarea id="item" name="item"
                                          class="form-control">{{ project.item|default:'' }}</textarea>
                            </div>
                            <div class="group-form">
                                <label for="count_total">تعداد کل</label>
                                <input type="number" id="count_total" class="form-control" name="count_total"
                                       required value="{{ project.count_total }}">
                            </div>
                            <div class="group-form">
                                <label for="count_remaining">تعداد باقی مانده</label>
                                <input type="number" id="count_remaining" class="form-control" name="count_remaining"
                                       required value="{{ project.count_remaining }}">
                            </div>
                            <div class="group-form justify-content-center">
                                <label for="has_sample">:نمونه</label>
                                <div class="d-flex gap-4">
                                    <label class="d-flex gap-1">
                                        ندارد
                                        <input type="radio" value="false"
                                               {% if not project.has_sample %}checked{% endif %} name="has_sample"
                                               oninput="toggleRelatedField('sample_date_div', false)">
                                    </label>
                                    <label class="d-flex gap-1">
                                        دارد
                                        <input type="radio" value="true" {% if project.has_sample %}checked{% endif %}
                                               name="has_sample" oninput="toggleRelatedField('sample_date_div', true)">
                                    </label>
                                </div>
                            </div>
                            <div class="group-form {% if not project.has_sample %}d-none{% endif %}"
                                 id="sample_date_div">
                                <label for="sample_delivery_datetime_picker"> :تاریخ تحویل نمونه</label>
                                <input type="text" name="" id="sample_delivery_datetime_picker"
                                       class="form-control persianDatapicker" set-on="sample_delivery_date"
                                       required readonly value="{{ project.get_sample_delivery_date_input }}">
                                <input type="hidden" id="sample_delivery_date" name="sample_delivery_date" required
                                       value="{{ project.get_sample_delivery_date_input }}">
                            </div>
                            <div class="group-form">
                                <label for="mass_delivery_datetime_picker"> :تاریخ تحویل انبوه</label>
                                <input type="text" name="" id="mass_delivery_datetime_picker"
                                       class="form-control persianDatapicker" set-on="mass_delivery_date"
                                       required readonly value="{{ project.get_mass_delivery_date_input }}">
                                <input type="hidden" id="mass_delivery_date" name="mass_delivery_date" required
                                       value="{{ project.get_mass_delivery_date_input }}">
                            </div>
                            <div class="group-form">
                                <label for="description">توضیحات</label>
                                <textarea type="number" id="description" class="form-control" name="description"
                                >{{ project.description }}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">لغو</button>
                        <button type="submit" class="btn btn-primary">ثبت و بروزرسانی</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

{% endblock %}

{% block Script %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let tasks_count = '{{ project.get_tasks.count }}'
        let tasks_progress_count = '{{ project.get_tasks_progress.count }}'
        let tasks_queue_count = '{{ project.get_tasks_queue.count }}'
        let tasks_finished_count = '{{ project.get_tasks_finished.count }}'
        let tasks_need_to_check_count = '{{ project.get_tasks_need_to_check.count }}'
        let tasks_need_to_replan_count = '{{ project.get_tasks_need_to_replan.count }}'
        let tasks_hold_count = '{{ project.get_tasks_hold.count }}'

        const chart_data = {
            labels: [
                'درحال انجام',
                'در صف',
                'انجام شده',
                'نگه داشته شده',
                'نیاز به بررسی',
                'نیاز به بررسی مجدد',
            ],
            datasets: [{
                label: 'تسک ها',
                data: [
                    tasks_progress_count,
                    tasks_queue_count,
                    tasks_finished_count,
                    tasks_hold_count,
                    tasks_need_to_check_count,
                    tasks_need_to_replan_count
                ],
                backgroundColor: [
                    'rgb(70,101,255)',
                    'rgb(204,181,7)',
                    'rgb(28,201,97)',
                    'rgb(222,113,10)',
                    'rgb(245,102,160)',
                    'rgb(241,29,52)',
                ],
                hoverOffset: 4
            }]
        }
        const chart_config = {
            type: 'doughnut',
            data: chart_data,
        };

        new Chart(document.querySelector("#chart"), chart_config)
    </script>
    <script type="module" src="{% static 'frontend/js/adminpanel.js' %}"></script>
    <script>
        function toggleRelatedField(fieldId, show = true) {
            const field = document.getElementById(fieldId);
            if (show) {
                field.classList.remove('d-none');
            } else {
                field.classList.add('d-none');
            }
        }
    </script>
{% endblock %}







